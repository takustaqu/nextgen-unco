<% 
	var title = "ホーム画面",
		bodyClass = "page-home",
		pageCss = "system";
%>
<% include elements/_header %>


<header id="welcome-message" class="">
	<h1>Welcome</h1>
	<div class="header-info">
		There are 100 of toilet around 1km from you.
	</div>
	<div class="bg">
		<img src="#" >
	</div>
	<div id="open-userpage">
		<a href="#"><i class="fa fa-user"></i> --</a>	
	</div>
</header>
<div class="sections">
	<section>
		<div class="column">
			<div class="col-full">
				<div class="panel" id="nearby-toilets">
					<h3>NEARBY TOILETS</h3>
					<ul class="toilets" id="default-toilet-list"></ul>
				</div>

				<div class="panel" id="panicmode-toilets">
					<h3>NEAREST TOILETS <small>KEEP CALM AND NEVER GIVE UP. <br>WE STILL CALLING NEARLY TOILETS OWNER.</small></h3>
					<ul class="toilet-finder">
					<li>
						<div class="status">
							<span class="icon"><i class="fa fa-ellipsis-h"></i></span>
							<span class="distance">9999m</span>
						</div>
						<div class="detail"></div>
					</li>

					<li class="ban">
						<div class="status">
							<span class="icon"><i class="fa fa-ban"></i></span>
							<span class="distance">9999m</span>
						</div>
					</li>
					<li class="allow">
						<div class="status">
							<span class="icon"><i class="fa fa-thumbs-up"></i></span>
							<span class="distance">9999m</span>
						</div>
						<div class="detail">

							<div class="item">
								<div class="thumbnail"><img src="/images/sampletoilet.jpg"></div>
								<div class="price">¥900</div>
								<div class="data"><div class="title">鷺ノ宮HQ</div><div class="review-counts"><span class="star"><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star-half-o"></i><i class="fa fa-star-o"></i></span><span class="count">2</span> <i class="fa fa-comment"></i><span class="count">1</span></div></div>
								<div class="buttons">
									<a href="" class="ui-btn ui-btn-positive">
										Choose this one
									</a>
									<a href="" class="ui-btn">
										Check details
									</a>
								</div>
							</div>
						</div>
					</li>
				</ul>
				</div>

			</div>
		</div>
	</section>
</div>


<!-- end contents -->
<% include elements/_footer %>
<script type="text/javascript" src="http://maps.google.com/maps?file=api&v=2.x&key=AIzaSyC106nTqtZDiQfmoaVKVOCNk0jHW7lPPTc"></script>

<script>

window.onload = function(){
	var client = new GStreetviewClient();
	_tool.refreshGeolocation(function(){

		$.ajax({
		    url: "http://api.airwn.co/api/get_user_detail?id=1",
		    dataType: "JSON",
		    cache: false,
		    success: function(data, textStatus){
				//この関数に引き渡したらばーん

				$("#welcome-message h1").text("Welcome,"+data.username+".");
				
				$("#open-userpage a").attr("href","/mypage.html?id="+data.id).html('<i class="fa fa-user"></i> '+data.username);
					var slatlng = 
					client.getNearestPanoramaLatLng(new GLatLng(geolocation.result.coords.latitude , geolocation.result.coords.longitude), setImage);

					function setImage(latlng){
					  
					  $("#welcome-message .bg img").css("background-image",'url(http://maps.googleapis.com/maps/api/streetview?size=960x480&amp;location='+latlng.lat()+','+latlng.lng()+'&amp;heading=235&amp;sensor=false)');
					}

				$("#welcome-message").removeClass("pending").addClass("ready");

		    },
		    error: function(xhr, textStatus, errorThrown){
		    	console.log("failed",xhr, textStatus, errorThrown)
		      return false;
		    }
		  });
		
	});

  $.ajax({
    url: "http://api.airwn.co/api/get_toilets",
    dataType: "JSON",
    cache: false,
    success: function(data, textStatus){
		//この関数に引き渡したらばーん
		_tool.setToiletList(data,"#default-toilet-list");
    },
    error: function(xhr, textStatus, errorThrown){
    	console.log("failed",xhr, textStatus, errorThrown)
      return false;
    }
  });

}

</script>